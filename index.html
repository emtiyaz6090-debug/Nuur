<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deen - The Complete Islamic App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Amiri&display=swap');
        
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #F8FAFC; color: #1E293B; margin: 0; padding: 0; }
        .header-gradient { background: linear-gradient(135deg, #4338ca 0%, #6366f1 100%); border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .page { display: none; min-height: 100vh; padding-bottom: 120px; animation: fadeIn 0.4s ease-out; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .font-arabic { font-family: 'Amiri', serif; }
        
        #smart-notify { 
            position: fixed; top: -150px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 380px; background: white; z-index: 2000;
            border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            transition: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        #smart-notify.show { top: 20px; }
        .nav-active { color: #ffffff !important; background: rgba(255,255,255,0.2); border-radius: 20px; }
        .nav-btn { padding: 10px 15px; transition: 0.3s; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body class="max-w-md mx-auto shadow-2xl bg-white">

    <div id="smart-notify" class="p-5 border-l-8 border-indigo-600 flex items-center space-x-4">
        <div class="bg-indigo-100 p-3 rounded-full text-indigo-600">
            <i class="fa-solid fa-bell animate-swing"></i>
        </div>
        <div class="flex-1">
            <h4 id="notify-title" class="font-bold text-indigo-900 text-sm">নোটিফিকেশন</h4>
            <p id="notify-msg" class="text-xs text-gray-600">সময় হয়ে গেছে!</p>
        </div>
        <button onclick="closeNotify()" class="text-gray-400"><i class="fa-solid fa-xmark"></i></button>
    </div>

    <div id="page-home" class="page active">
        <div class="header-gradient pt-10 pb-28 px-6 text-white text-center">
            <div class="flex justify-between items-center mb-6">
                <i class="fa-solid fa-bars-staggered text-xl opacity-70"></i>
                <h1 class="text-2xl font-black uppercase italic tracking-widest">DEEN</h1>
                <button onclick="getLocation()" class="bg-white/20 p-2 rounded-full"><i class="fa-solid fa-location-crosshairs"></i></button>
            </div>
            <div class="space-y-1">
                <p id="hijri-date" class="text-xl font-bold">লোড হচ্ছে...</p>
                <p id="gregorian-date" class="text-xs opacity-70"></p>
                <div class="mt-4">
                    <select id="manual-location" onchange="fetchTimes(this.value)" class="bg-white/20 border-none rounded-full px-4 py-1 text-xs outline-none cursor-pointer">
                        <option value="Lakshmipur" class="text-black">লক্ষ্মীপুর</option>
                        <option value="Dhaka" class="text-black">ঢাকা</option>
                        <option value="Chittagong" class="text-black">চট্টগ্রাম</option>
                        <option value="Sylhet" class="text-black">সিলেট</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="px-5 -mt-20">
            <div class="glass-card p-6 border border-white/50">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-indigo-600 font-bold text-[10px] uppercase tracking-wider">পরবর্তী নামাজ: <span id="next-prayer-name">...</span></p>
                        <h2 id="next-prayer-time" class="text-5xl font-black text-slate-900 my-1">--:--</h2>
                        <div class="flex space-x-2 mt-4">
                            <div class="bg-blue-50 p-2 rounded-xl text-center flex-1">
                                <p class="text-[9px] font-bold text-blue-500 uppercase">সেহরি</p>
                                <p id="suhur-time" class="font-bold text-blue-900 text-sm">--:--</p>
                            </div>
                            <div class="bg-orange-50 p-2 rounded-xl text-center flex-1">
                                <p class="text-[9px] font-bold text-orange-600 uppercase">ইফতার</p>
                                <p id="iftar-time" class="font-bold text-orange-900 text-sm">--:--</p>
                            </div>
                        </div>
                    </div>
                    <div class="text-indigo-100"><i class="fa-solid fa-mosque text-6xl"></i></div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-4 gap-4 px-5 mt-8">
            <div onclick="openQuran()" class="flex flex-col items-center">
                <div class="w-14 h-14 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center shadow-sm"><i class="fa-solid fa-book-quran text-xl"></i></div>
                <span class="text-[11px] font-bold mt-2">কুরআন</span>
            </div>
            <div onclick="switchPage('tasbih')" class="flex flex-col items-center">
                <div class="w-14 h-14 bg-orange-100 text-orange-600 rounded-2xl flex items-center justify-center shadow-sm"><i class="fa-solid fa-calculator text-xl"></i></div>
                <span class="text-[11px] font-bold mt-2">তাসবিহ</span>
            </div>
            <div onclick="switchPage('dua')" class="flex flex-col items-center">
                <div class="w-14 h-14 bg-purple-100 text-purple-600 rounded-2xl flex items-center justify-center shadow-sm"><i class="fa-solid fa-hands-praying text-xl"></i></div>
                <span class="text-[11px] font-bold mt-2">দুয়া</span>
            </div>
            <div onclick="openNames()" class="flex flex-col items-center">
                <div class="w-14 h-14 bg-rose-100 text-rose-600 rounded-2xl flex items-center justify-center shadow-sm"><i class="fa-solid fa-heart text-xl"></i></div>
                <span class="text-[11px] font-bold mt-2">৯৯ নাম</span>
            </div>
        </div>

        <div class="px-5 mt-8 space-y-4">
            <div class="bg-white p-5 rounded-3xl border border-gray-100 shadow-sm">
                <h3 class="font-bold text-sm mb-2 text-indigo-600"><i class="fa-solid fa-quote-left mr-2"></i>আজকের বাণী</h3>
                <p class="text-sm text-gray-600 italic">"নিশ্চয়ই কষ্টের সাথে স্বস্তি রয়েছে।" (সূরা আল-ইনশিরাহ: ০৬)</p>
            </div>
            <div class="bg-indigo-900 text-white p-5 rounded-3xl shadow-xl relative overflow-hidden">
                <h3 class="font-bold text-sm mb-3">নামাজের পূর্ণ সময়সূচী</h3>
                <div id="full-schedule" class="grid grid-cols-3 gap-3 text-[10px] uppercase font-bold">
                    </div>
            </div>
        </div>
    </div>

    <div id="page-quran" class="page px-5 pt-8">
        <h2 class="text-2xl font-black mb-6">আল-কুরআন</h2>
        <div id="surah-list" class="space-y-3"></div>
    </div>

    <div id="page-dua" class="page px-5 pt-8">
        <h2 class="text-2xl font-black mb-6">প্রয়োজনীয় দুয়া</h2>
        <div id="dua-list" class="space-y-4"></div>
    </div>

    <div id="page-tasbih" class="page px-5 pt-12 text-center">
        <h2 class="text-2xl font-bold mb-10">ডিজিটাল তাসবিহ</h2>
        <div onclick="countT()" class="w-64 h-64 bg-white rounded-full mx-auto flex flex-col items-center justify-center shadow-2xl border-[12px] border-indigo-50 active:scale-95 transition cursor-pointer">
            <span id="t-count" class="text-7xl font-black text-indigo-600">0</span>
            <p class="text-xs font-bold text-gray-300 mt-2 uppercase">Tap to Count</p>
        </div>
        <button onclick="resetT()" class="mt-12 text-gray-400 underline">রিসেট করুন</button>
    </div>

    <div id="page-names" class="page px-5 pt-8">
        <h2 class="text-2xl font-black mb-6 text-center">আল্লাহর ৯৯টি নাম</h2>
        <div id="names-grid" class="grid grid-cols-2 gap-3"></div>
    </div>

    <div id="surah-detail" class="fixed inset-0 bg-white z-[100] hidden overflow-y-auto p-6">
        <div class="flex justify-between items-center mb-6 sticky top-0 bg-white py-2 border-b">
            <button onclick="closeSurah()" class="text-indigo-600 font-bold"><i class="fa-solid fa-arrow-left mr-2"></i>পিছনে</button>
            <h2 id="surah-title" class="text-xl font-bold font-arabic text-indigo-900"></h2>
            <div class="w-10"></div>
        </div>
        <div id="audio-container" class="bg-indigo-50 p-6 rounded-3xl mb-8 text-center">
            <audio id="surah-audio"></audio>
            <button id="play-btn" onclick="toggleAudio()" class="w-16 h-16 bg-indigo-600 text-white rounded-full text-2xl shadow-lg">
                <i class="fa-solid fa-play"></i>
            </button>
            <p class="text-[10px] mt-3 text-indigo-400 font-bold uppercase tracking-widest">Reciter: Al-Afasy</p>
        </div>
        <div id="ayats" class="space-y-8 text-right"></div>
    </div>

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-sm bg-indigo-950 rounded-[30px] flex justify-around items-center py-3 z-[90] shadow-2xl">
        <button onclick="switchPage('home')" id="nav-home" class="nav-btn text-white/50 nav-active"><i class="fa-solid fa-house"></i></button>
        <button onclick="openQuran()" id="nav-quran" class="nav-btn text-white/50"><i class="fa-solid fa-book-open"></i></button>
        <button onclick="switchPage('tasbih')" id="nav-tasbih" class="nav-btn text-white/50"><i class="fa-solid fa-calculator"></i></button>
        <button onclick="switchPage('dua')" id="nav-dua" class="nav-btn text-white/50"><i class="fa-solid fa-hands-praying"></i></button>
    </nav>

    <script>
        // --- DATA ---
        const duas = [
            { t: "খাবার শুরুর দুয়া", a: "بِسْمِ اللَّهِ", b: "বিসমিল্লাহ।", r: "খাবার শুরুতে পড়তে হয়।" },
            { t: "খাবার শেষের দুয়া", a: "الْحَمْدُ لِلَّهِ الَّذِي أَطْعَمَنَا وَسَقَانَا", b: "সকল প্রশংসা আল্লাহর জন্য যিনি আমাদের খাইয়েছেন ও পান করিয়েছেন।", r: "আবু দাউদ" },
            { t: "ঘুমানোর দুয়া", a: "اللَّهُمَّ بِاسْمِكَ أَمُوتُ وَأَحْيَا", b: "হে আল্লাহ! আপনার নামেই আমি মরি এবং আপনার নামেই জীবিত হই।", r: "বুখারি" },
            { t: "আয়নায় দেখার দুয়া", a: "اللَّهُمَّ أَنْتَ حَسَّنْتَ خَلْقِي فَحَسِّنْ خُلُقِي", b: "হে আল্লাহ! আপনি আমার গঠন সুন্দর করেছেন, আমার চরিত্রও সুন্দর করে দিন।", r: "হিসনুল মুসলিম" }
        ];

        // --- CORE FUNCTIONS ---
        function switchPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            
            // Nav styling
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('nav-active'));
            const activeNav = document.getElementById('nav-' + id);
            if(activeNav) activeNav.classList.add('nav-active');

            if(id === 'dua') renderDuas();
            window.scrollTo(0,0);
        }

        function renderDuas() {
            const list = document.getElementById('dua-list');
            list.innerHTML = duas.map(d => `
                <div class="bg-gray-50 p-5 rounded-3xl border border-gray-100">
                    <p class="text-xs font-black text-indigo-500 mb-2 uppercase">${d.t}</p>
                    <p class="font-arabic text-2xl mb-2" dir="rtl">${d.a}</p>
                    <p class="text-sm text-gray-600 font-bold">${d.b}</p>
                </div>
            `).join('');
        }

        async function fetchTimes(city) {
            try {
                const res = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Bangladesh&method=1`);
                const data = await res.json();
                const t = data.data.timings;

                document.getElementById('suhur-time').innerText = t.Fajr;
                document.getElementById('iftar-time').innerText = t.Maghrib;
                document.getElementById('hijri-date').innerText = `${data.data.date.hijri.day} ${data.data.date.hijri.month.en} ${data.data.date.hijri.year}`;
                document.getElementById('gregorian-date').innerText = data.data.date.readable;

                document.getElementById('full-schedule').innerHTML = `
                    <div class="bg-white/10 p-2 rounded-lg text-center">ফজর<br>${t.Fajr}</div>
                    <div class="bg-white/10 p-2 rounded-lg text-center">যোহর<br>${t.Dhuhr}</div>
                    <div class="bg-white/10 p-2 rounded-lg text-center">আসর<br>${t.Asr}</div>
                    <div class="bg-white/10 p-2 rounded-lg text-center">মাগরিব<br>${t.Maghrib}</div>
                    <div class="bg-white/10 p-2 rounded-lg text-center">এশা<br>${t.Isha}</div>
                    <div class="bg-white/10 p-2 rounded-lg text-center">সূর্যোদয়<br>${t.Sunrise}</div>
                `;

                updateNextPrayer(t);
            } catch (e) { console.log("API Error"); }
        }

        function updateNextPrayer(t) {
            const now = new Date();
            const mins = now.getHours() * 60 + now.getMinutes();
            const schedule = [
                {n:'ফজর', t:t.Fajr}, {n:'যোহর', t:t.Dhuhr}, {n:'আসর', t:t.Asr}, {n:'মাগরিব', t:t.Maghrib}, {n:'এশা', t:t.Isha}
            ];
            let next = schedule[0];
            for(let p of schedule) {
                const [h, m] = p.t.split(':').map(Number);
                if((h*60+m) > mins) { next = p; break; }
            }
            document.getElementById('next-prayer-name').innerText = next.n;
            document.getElementById('next-prayer-time').innerText = next.t;
        }

        // --- QURAN LOGIC ---
        async function openQuran() {
            switchPage('quran');
            const list = document.getElementById('surah-list');
            list.innerHTML = "<p class='text-center opacity-50'>সূরা লোড হচ্ছে...</p>";
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            list.innerHTML = data.data.map(s => `
                <div onclick="loadSurah(${s.number}, '${s.name}')" class="p-4 bg-gray-50 rounded-2xl flex justify-between items-center cursor-pointer hover:bg-indigo-50">
                    <div class="flex items-center space-x-4">
                        <span class="bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">${s.number}</span>
                        <div class="font-bold text-indigo-900">${s.englishName}</div>
                    </div>
                    <div class="font-arabic text-xl">${s.name}</div>
                </div>
            `).join('');
        }

        async function loadSurah(num, name) {
            const detail = document.getElementById('surah-detail');
            const ayatsDiv = document.getElementById('ayats');
            detail.classList.remove('hidden');
            document.getElementById('surah-title').innerText = name;
            ayatsDiv.innerHTML = "<p class='text-center py-20'>আয়াত লোড হচ্ছে...</p>";

            const [arRes, bnRes] = await Promise.all([
                fetch(`https://api.alquran.cloud/v1/surah/${num}`),
                fetch(`https://api.alquran.cloud/v1/surah/${num}/bn.bengali`)
            ]);
            const ar = await arRes.json();
            const bn = await bnRes.json();

            ayatsDiv.innerHTML = ar.data.ayahs.map((a, i) => `
                <div class="border-b pb-6">
                    <p class="font-arabic text-3xl leading-relaxed text-indigo-950 mb-3">${a.text}</p>
                    <p class="text-sm text-gray-500 text-left font-bold">${bn.data.ayahs[i].text}</p>
                    <span class="inline-block mt-2 text-[10px] bg-gray-100 px-2 py-1 rounded-full">${a.numberInSurah}</span>
                </div>
            `).join('');

            const audio = document.getElementById('surah-audio');
            audio.src = `https://download.quranicaudio.com/quran/mishari_rashid_al_afasy/${String(num).padStart(3, '0')}.mp3`;
        }

        function toggleAudio() {
            const a = document.getElementById('surah-audio');
            const btn = document.getElementById('play-btn');
            if(a.paused) { a.play(); btn.innerHTML = '<i class="fa-solid fa-pause"></i>'; }
            else { a.pause(); btn.innerHTML = '<i class="fa-solid fa-play"></i>'; }
        }

        function closeSurah() {
            document.getElementById('surah-detail').classList.add('hidden');
            document.getElementById('surah-audio').pause();
            document.getElementById('play-btn').innerHTML = '<i class="fa-solid fa-play"></i>';
        }

        // --- OTHER ---
        async function openNames() {
            switchPage('names');
            const res = await fetch('https://api.aladhan.com/v1/asmaAlHusna');
            const data = await res.json();
            document.getElementById('names-grid').innerHTML = data.data.map(n => `
                <div class="bg-gray-50 p-4 rounded-2xl text-center">
                    <p class="font-arabic text-2xl text-indigo-900">${n.name}</p>
                    <p class="text-xs font-bold">${n.transliteration}</p>
                </div>
            `).join('');
        }

        let tc = 0;
        function countT() { tc++; document.getElementById('t-count').innerText = tc; if(navigator.vibrate) navigator.vibrate(50); }
        function resetT() { tc = 0; document.getElementById('t-count').innerText = 0; }

        function showNotify(title, msg) {
            const p = document.getElementById('smart-notify');
            document.getElementById('notify-title').innerText = title;
            document.getElementById('notify-msg').innerText = msg;
            p.classList.add('show');
            setTimeout(() => p.classList.remove('show'), 10000);
        }
        function closeNotify() { document.getElementById('smart-notify').classList.remove('show'); }

        function getLocation() {
            navigator.geolocation.getCurrentPosition(p => fetchTimes(null, p.coords.latitude, p.coords.longitude), () => fetchTimes("Lakshmipur"));
        }

        window.onload = () => fetchTimes("Lakshmipur");
    </script>
</body>
  </html>
