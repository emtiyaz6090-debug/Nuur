<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deen - Ultimate Islam App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Amiri&display=swap');
        
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #F1F5F9; color: #1E293B; }
        .header-gradient { background: linear-gradient(180deg, #3B4CC0 0%, #6366F1 100%); border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .page { display: none; min-height: 100vh; padding-bottom: 100px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .font-arabic { font-family: 'Amiri', serif; }
        
        /* Unique Notification Style */
        #smart-notify { 
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 350px; background: white; z-index: 1000;
            border-radius: 20px; box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #smart-notify.show { top: 20px; }
    </style>
</head>
<body class="max-w-md mx-auto">

    <div id="smart-notify" class="p-4 border-l-4 border-indigo-600 flex items-center space-x-4">
        <div class="bg-indigo-100 p-3 rounded-full text-indigo-600">
            <i class="fa-solid fa-bell-astronomy"></i>
        </div>
        <div>
            <h4 id="notify-title" class="font-bold text-sm">নোটিফিকেশন</h4>
            <p id="notify-msg" class="text-xs text-gray-500">সময় হয়ে গেছে!</p>
        </div>
        <button onclick="closeNotify()" class="text-gray-300"><i class="fa-solid fa-xmark"></i></button>
    </div>

    <div id="page-home" class="page active">
        <div class="header-gradient pt-8 pb-24 px-6 relative text-white text-center">
            <div class="flex justify-between items-center mb-6">
                <button class="p-2 bg-white/20 rounded-full"><i class="fa-solid fa-bars"></i></button>
                <h1 class="text-xl font-bold tracking-widest uppercase">Deen</h1>
                <button onclick="getLocation()" class="p-2 bg-white/20 rounded-full"><i class="fa-solid fa-location-crosshairs"></i></button>
            </div>
            <div class="mb-4">
                <p id="hijri-date" class="text-lg font-semibold">লোড হচ্ছে...</p>
                <p id="gregorian-date" class="text-sm opacity-80">-- --- ----</p>
            </div>
            <select id="manual-location" class="w-48 bg-white/20 backdrop-blur-md border border-white/30 text-white text-sm rounded-xl px-4 py-2 outline-none">
                <option value="Dhaka" class="text-black">ঢাকা</option>
                <option value="Lakshmipur" class="text-black" selected>লক্ষ্মীপুর</option>
                <option value="Chittagong" class="text-black">চট্টগ্রাম</option>
                <option value="Sylhet" class="text-black">সিলেট</option>
            </select>
        </div>

        <div class="px-5 -mt-16">
            <div class="glass-card p-6 border border-white">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-indigo-600 font-bold text-sm">পরবর্তী নামাজ: <span id="next-prayer-name">...</span></p>
                        <h2 id="next-prayer-time" class="text-5xl font-black text-indigo-950 my-2">--:--</h2>
                        <div class="flex space-x-3 mt-4">
                            <div class="bg-blue-50 p-2 rounded-lg text-center flex-1">
                                <p class="text-[9px] font-bold text-blue-500">সেহরি শেষ</p>
                                <p id="suhur-time" class="font-bold text-blue-900">--:--</p>
                            </div>
                            <div class="bg-orange-50 p-2 rounded-lg text-center flex-1">
                                <p class="text-[9px] font-bold text-orange-500">ইফতার শুরু</p>
                                <p id="iftar-time" class="font-bold text-orange-900">--:--</p>
                            </div>
                        </div>
                    </div>
                    <div class="text-indigo-100"><i class="fa-solid fa-kaaba text-6xl"></i></div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-4 gap-4 px-5 mt-8">
            <div onclick="openQuran()" class="flex flex-col items-center">
                <div class="feature-icon bg-blue-100 text-blue-600"><i class="fa-solid fa-book-quran text-xl"></i></div>
                <span class="text-[11px] font-bold mt-1">কুরআন</span>
            </div>
            <div onclick="switchPage('tasbih')" class="flex flex-col items-center">
                <div class="feature-icon bg-orange-100 text-orange-600"><i class="fa-solid fa-calculator text-xl"></i></div>
                <span class="text-[11px] font-bold mt-1">তাসবিহ</span>
            </div>
            <div onclick="switchPage('dua')" class="flex flex-col items-center">
                <div class="feature-icon bg-purple-100 text-purple-600"><i class="fa-solid fa-hand-holding-heart text-xl"></i></div>
                <span class="text-[11px] font-bold mt-1">দুয়া</span>
            </div>
            <div onclick="openNames()" class="flex flex-col items-center">
                <div class="feature-icon bg-red-100 text-red-600"><i class="fa-solid fa-heart text-xl"></i></div>
                <span class="text-[11px] font-bold mt-1">৯৯ নাম</span>
            </div>
        </div>
    </div>

    <div id="page-quran" class="page px-5 pt-8 bg-white">
        <h2 class="text-2xl font-bold mb-4">পবিত্র কুরআন</h2>
        <div id="surah-list" class="space-y-3 pb-20"></div>
    </div>

    <div id="surah-detail" class="fixed inset-0 bg-white z-[60] hidden overflow-y-auto p-6">
        <button onclick="closeSurah()" class="mb-4 text-indigo-600"><i class="fa-solid fa-arrow-left"></i> ফিরে যান</button>
        <div class="text-center">
            <h2 id="surah-title" class="text-3xl font-bold mb-4 font-arabic"></h2>
            <div id="audio-box" class="mb-6 p-4 bg-gray-50 rounded-2xl">
                <audio id="surah-audio" class="hidden"></audio>
                <button id="play-btn" onclick="toggleAudio()" class="w-16 h-16 bg-indigo-600 text-white rounded-full text-2xl">
                    <i class="fa-solid fa-play"></i>
                </button>
                <p class="text-xs mt-2 text-gray-400">শুনুন (মিশারি রাশিদ আল-আফাসি)</p>
            </div>
            <div id="ayats" class="space-y-8 text-right"></div>
        </div>
    </div>

    <div id="page-names" class="page px-5 pt-8 bg-white">
        <h2 class="text-2xl font-bold mb-6">আল্লাহর ৯৯টি নাম</h2>
        <div id="names-grid" class="grid grid-cols-2 gap-4"></div>
    </div>

    <div id="page-tasbih" class="page px-5 pt-12 text-center bg-white">
        <h2 class="text-2xl font-bold mb-8">তাসবিহ কাউন্টার</h2>
        <div onclick="countT()" class="bg-indigo-50 w-64 h-64 rounded-full mx-auto flex flex-col items-center justify-center border-[12px] border-white shadow-2xl active:scale-95 transition-all cursor-pointer">
            <span id="t-count" class="text-7xl font-bold text-indigo-600">0</span>
            <p class="text-indigo-300 font-bold uppercase tracking-widest text-xs mt-2">Tap to Count</p>
        </div>
        <button onclick="resetT()" class="mt-12 text-gray-400 border-b border-gray-200 pb-1">রিসেট করুন</button>
    </div>

    <div id="page-dua" class="page px-5 pt-8 bg-white">
        <h2 class="text-2xl font-bold mb-6">প্রয়োজনীয় দুয়া</h2>
        <div class="space-y-4" id="dua-list">
            </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/90 backdrop-blur-md border-t flex justify-around items-center py-4 z-50">
        <div onclick="switchPage('home')" class="nav-item flex flex-col items-center text-indigo-600"><i class="fa-solid fa-house"></i></div>
        <div onclick="openQuran()" class="nav-item flex flex-col items-center text-gray-400"><i class="fa-solid fa-book-open"></i></div>
        <div onclick="switchPage('tasbih')" class="nav-item flex flex-col items-center text-gray-400"><i class="fa-solid fa-calculator"></i></div>
        <div onclick="openNames()" class="nav-item flex flex-col items-center text-gray-400"><i class="fa-solid fa-heart"></i></div>
    </nav>

    <script>
        let currentSuhur, currentIftar;

        // --- Core Switching ---
        function switchPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            // Update nav colors
            const icons = document.querySelectorAll('.nav-item');
            icons.forEach(icon => icon.classList.replace('text-indigo-600', 'text-gray-400'));
        }

        // --- Prayer & Notification Logic ---
        async function fetchTimes(city) {
            const res = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Bangladesh&method=1`);
            const data = await res.json();
            const t = data.data.timings;

            currentSuhur = t.Fajr;
            currentIftar = t.Maghrib;

            document.getElementById('suhur-time').innerText = t.Fajr;
            document.getElementById('iftar-time').innerText = t.Maghrib;
            document.getElementById('hijri-date').innerText = `${data.data.date.hijri.day} ${data.data.date.hijri.month.en} ${data.data.date.hijri.year}`;
            document.getElementById('gregorian-date').innerText = data.data.date.readable;

            updateNextPrayer(t);
        }

        function updateNextPrayer(t) {
            const now = new Date();
            const mins = now.getHours() * 60 + now.getMinutes();
            const schedule = [
                {n:'ফজর', t:t.Fajr}, {n:'যোহর', t:t.Dhuhr}, {n:'আসর', t:t.Asr}, {n:'মাগরিব', t:t.Maghrib}, {n:'এশা', t:t.Isha}
            ];
            let next = schedule[0];
            for(let p of schedule) {
                const [h, m] = p.t.split(':').map(Number);
                if((h*60+m) > mins) { next = p; break; }
            }
            document.getElementById('next-prayer-name').innerText = next.n;
            document.getElementById('next-prayer-time').innerText = next.t;
        }

        // Check for Sahri/Iftar Every Minute
        setInterval(() => {
            const now = new Date();
            const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            if(timeStr === currentSuhur) showNotify("সেহরির সময় শেষ!", "দয়া করে পানাহার বন্ধ করুন।");
            if(timeStr === currentIftar) showNotify("ইফতারের সময় হয়েছে!", "দয়া করে ইফতার করুন। আল্লাহ কবুল করুন।");
        }, 60000);

        function showNotify(title, msg) {
            document.getElementById('notify-title').innerText = title;
            document.getElementById('notify-msg').innerText = msg;
            const panel = document.getElementById('smart-notify');
            panel.classList.add('show');
            if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
            setTimeout(closeNotify, 10000);
        }

        function closeNotify() { document.getElementById('smart-notify').classList.remove('show'); }

        // --- Quran with Bengali Translation ---
        async function openQuran() {
            switchPage('quran');
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            const list = document.getElementById('surah-list');
            list.innerHTML = data.data.map(s => `
                <div onclick="loadSurah(${s.number}, '${s.name}')" class="p-4 glass-card flex justify-between items-center cursor-pointer border border-gray-50">
                    <div>
                        <span class="text-xs font-bold text-indigo-500">SURAH ${s.number}</span>
                        <h3 class="font-bold">${s.englishName}</h3>
                        <p class="text-[10px] text-gray-400">${s.revelationType} • ${s.numberOfAyahs} Ayahs</p>
                    </div>
                    <div class="font-arabic text-2xl text-indigo-900">${s.name}</div>
                </div>
            `).join('');
        }

        async function loadSurah(num, name) {
            document.getElementById('surah-detail').classList.remove('hidden');
            document.getElementById('surah-title').innerText = name;
            document.getElementById('ayats').innerHTML = "<p class='text-center py-10'>লোড হচ্ছে...</p>";

            // Fetch Arabic and Bengali Translation
            const [arRes, bnRes] = await Promise.all([
                fetch(`https://api.alquran.cloud/v1/surah/${num}`),
                fetch(`https://api.alquran.cloud/v1/surah/${num}/bn.bengali`)
            ]);
            const arData = await arRes.json();
            const bnData = await bnRes.json();

            let html = "";
            arData.data.ayahs.forEach((ayah, i) => {
                html += `
                    <div class="border-b border-gray-100 pb-6">
                        <p class="font-arabic text-3xl leading-relaxed mb-3 text-indigo-950">${ayah.text}</p>
                        <p class="text-right text-sm text-gray-600 font-medium">${bnData.data.ayahs[i].text}</p>
                        <span class="inline-block mt-2 text-[10px] bg-indigo-50 text-indigo-500 px-2 py-1 rounded-full">আয়াত ${ayah.numberInSurah}</span>
                    </div>
                `;
            });
            document.getElementById('ayats').innerHTML = html;
            document.getElementById('surah-audio').src = `https://download.quranicaudio.com/quran/mishari_rashid_al_afasy/${String(num).padStart(3, '0')}.mp3`;
        }

        function closeSurah() {
            document.getElementById('surah-detail').classList.add('hidden');
            const audio = document.getElementById('surah-audio');
            audio.pause();
            document.getElementById('play-btn').innerHTML = '<i class="fa-solid fa-play"></i>';
        }

        function toggleAudio() {
            const audio = document.getElementById('surah-audio');
            const btn = document.getElementById('play-btn');
            if(audio.paused) {
                audio.play();
                btn.innerHTML = '<i class="fa-solid fa-pause"></i>';
            } else {
                audio.pause();
                btn.innerHTML = '<i class="fa-solid fa-play"></i>';
            }
        }

        // --- 99 Names ---
        async function openNames() {
            switchPage('names');
            const res = await fetch('https://api.aladhan.com/v1/asmaAlHusna');
            const data = await res.json();
            document.getElementById('names-grid').innerHTML = data.data.map(n => `
                <div class="p-4 bg-indigo-50 rounded-2xl text-center">
                    <p class="font-arabic text-2xl text-indigo-900">${n.name}</p>
                    <p class="font-bold text-sm mt-1">${n.transliteration}</p>
                    <p class="text-[10px] text-gray-500">${n.en.meaning}</p>
                </div>
            `).join('');
        }

        // --- Tasbih ---
        let count = 0;
        function countT() { 
            count++; 
            document.getElementById('t-count').innerText = count; 
            if(navigator.vibrate) navigator.vibrate(40);
        }
        function resetT() { count = 0; document.getElementById('t-count').innerText = 0; }

        // --- Location ---
        function getLocation() {
            navigator.geolocation.getCurrentPosition(p => fetchTimes(null, p.coords.latitude, p.coords.longitude), () => fetchTimes("Lakshmipur"));
        }

        window.onload = () => fetchTimes("Lakshmipur");
        document.getElementById('manual-location').addEventListener('change', (e) => fetchTimes(e.target.value));

    </script>
</body>
      </html>
