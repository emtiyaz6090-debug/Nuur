<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deen - The Complete Islamic App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Amiri&display=swap');
        
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #F8FAFC; color: #1E293B; margin: 0; padding: 0; }
        .header-gradient { background: linear-gradient(135deg, #4338ca 0%, #6366f1 100%); border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .page { display: none; min-height: 100vh; padding-bottom: 120px; animation: fadeIn 0.4s ease-out; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .font-arabic { font-family: 'Amiri', serif; }
        .nav-active { color: #ffffff !important; background: rgba(255,255,255,0.2); border-radius: 20px; }
        .nav-btn { padding: 10px 15px; transition: 0.3s; }
    </style>
</head>
<body class="max-w-md mx-auto shadow-2xl bg-white">

    <div id="page-home" class="page active">
        <div class="header-gradient pt-10 pb-28 px-6 text-white text-center">
            <div class="flex justify-between items-center mb-6">
                <i class="fa-solid fa-bars-staggered text-xl opacity-70"></i>
                <h1 class="text-2xl font-black italic tracking-widest">DEEN</h1>
                <button onclick="getLocation()" class="bg-white/20 p-2 rounded-full"><i class="fa-solid fa-location-crosshairs"></i></button>
            </div>
            <div class="space-y-1">
                <p id="hijri-date" class="text-xl font-bold">লোড হচ্ছে...</p>
                <p id="gregorian-date" class="text-xs opacity-70"></p>
                <div class="mt-3 bg-yellow-400 text-indigo-900 text-[10px] font-bold px-3 py-1 rounded-full inline-block">
                    ১লা রমজান আসতে আর মাত্র কিছু সময় বাকি!
                </div>
            </div>
        </div>

        <div class="px-5 -mt-20">
            <div class="glass-card p-6 border border-white/50">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-indigo-600 font-bold text-[10px] uppercase">পরবর্তী নামাজ: <span id="next-prayer-name">...</span></p>
                        <h2 id="next-prayer-time" class="text-4xl font-black text-slate-900 my-1">--:-- --</h2>
                        <div class="flex space-x-2 mt-4">
                            <div class="bg-blue-50 p-2 rounded-xl text-center flex-1">
                                <p class="text-[9px] font-bold text-blue-500 uppercase">সেহরি শেষ</p>
                                <p id="suhur-time" class="font-bold text-blue-900 text-sm">--:--</p>
                            </div>
                            <div class="bg-orange-50 p-2 rounded-xl text-center flex-1">
                                <p class="text-[9px] font-bold text-orange-600 uppercase">ইফতার শুরু</p>
                                <p id="iftar-time" class="font-bold text-orange-900 text-sm">--:--</p>
                            </div>
                        </div>
                    </div>
                    <div class="text-indigo-600 opacity-20"><i class="fa-solid fa-moon text-6xl"></i></div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-4 gap-4 px-5 mt-8">
            <div onclick="openQuran()" class="flex flex-col items-center">
                <div class="w-14 h-14 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center shadow-sm"><i class="fa-solid fa-book-quran text-xl"></i></div>
                <span class="text-[11px] font-bold mt-2">কুরআন</span>
            </div>
            <div onclick="switchPage('tasbih')" class="flex flex-col items-center">
                <div class="w-14 h-14 bg-orange-100 text-orange-600 rounded-2xl flex items-center justify-center shadow-sm"><i class="fa-solid fa-calculator text-xl"></i></div>
                <span class="text-[11px] font-bold mt-2">তাসবিহ</span>
            </div>
            <div onclick="switchPage('dua')" class="flex flex-col items-center">
                <div class="w-14 h-14 bg-purple-100 text-purple-600 rounded-2xl flex items-center justify-center shadow-sm"><i class="fa-solid fa-hands-praying text-xl"></i></div>
                <span class="text-[11px] font-bold mt-2">দুয়া</span>
            </div>
            <div onclick="openNames()" class="flex flex-col items-center">
                <div class="w-14 h-14 bg-rose-100 text-rose-600 rounded-2xl flex items-center justify-center shadow-sm"><i class="fa-solid fa-heart text-xl"></i></div>
                <span class="text-[11px] font-bold mt-2">৯৯ নাম</span>
            </div>
        </div>

        <div class="px-5 mt-8 mb-10">
            <div class="bg-indigo-900 text-white p-5 rounded-3xl shadow-xl">
                <h3 class="font-bold text-sm mb-3 border-b border-white/20 pb-2">আজকের পূর্ণ সময়সূচী</h3>
                <div id="full-schedule" class="grid grid-cols-2 gap-4 text-xs font-semibold">
                    </div>
            </div>
        </div>
    </div>

    <div id="page-quran" class="page px-5 pt-8">
        <h2 class="text-2xl font-black mb-6">আল-কুরআন</h2>
        <div id="surah-list" class="space-y-3 pb-10"></div>
    </div>

    <div id="surah-detail" class="fixed inset-0 bg-white z-[100] hidden overflow-y-auto p-6">
        <div class="flex justify-between items-center mb-6 sticky top-0 bg-white py-2 border-b">
            <button onclick="closeSurah()" class="text-indigo-600 font-bold"><i class="fa-solid fa-arrow-left mr-2"></i>পিছনে</button>
            <h2 id="surah-title" class="text-xl font-bold font-arabic text-indigo-900"></h2>
            <div class="w-10"></div>
        </div>
        <div id="audio-container" class="bg-indigo-50 p-6 rounded-3xl mb-8 text-center border border-indigo-100">
            <audio id="surah-audio" preload="none"></audio>
            <div class="flex justify-center items-center space-x-6">
                <button id="play-btn" onclick="toggleAudio()" class="w-16 h-16 bg-indigo-600 text-white rounded-full text-2xl shadow-lg flex items-center justify-center">
                    <i class="fa-solid fa-play ml-1"></i>
                </button>
            </div>
            <p id="audio-status" class="text-[10px] mt-3 text-indigo-400 font-bold uppercase tracking-widest">Reciter: Mishary Al-Afasy</p>
        </div>
        <div id="ayats" class="space-y-8 text-right pb-20"></div>
    </div>

    <div id="page-tasbih" class="page px-5 pt-12 text-center">
        <h2 class="text-2xl font-bold mb-10">ডিজিটাল তাসবিহ</h2>
        <div onclick="countT()" class="w-64 h-64 bg-white rounded-full mx-auto flex flex-col items-center justify-center shadow-2xl border-[12px] border-indigo-50 active:scale-95 transition cursor-pointer">
            <span id="t-count" class="text-7xl font-black text-indigo-600">0</span>
            <p class="text-xs font-bold text-gray-300 mt-2 uppercase">Tap to Count</p>
        </div>
        <button onclick="resetT()" class="mt-12 text-gray-400 underline">রিসেট করুন</button>
    </div>

    <div id="page-dua" class="page px-5 pt-8">
        <h2 class="text-2xl font-black mb-6">প্রয়োজনীয় দুয়া</h2>
        <div id="dua-list" class="space-y-4"></div>
    </div>

    <div id="page-names" class="page px-5 pt-8">
        <h2 class="text-2xl font-black mb-6 text-center">আল্লাহর ৯৯টি নাম</h2>
        <div id="names-grid" class="grid grid-cols-2 gap-3"></div>
    </div>

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-sm bg-indigo-950 rounded-[30px] flex justify-around items-center py-3 z-[90] shadow-2xl">
        <button onclick="switchPage('home')" id="nav-home" class="nav-btn text-white/50 nav-active"><i class="fa-solid fa-house"></i></button>
        <button onclick="openQuran()" id="nav-quran" class="nav-btn text-white/50"><i class="fa-solid fa-book-open"></i></button>
        <button onclick="switchPage('tasbih')" id="nav-tasbih" class="nav-btn text-white/50"><i class="fa-solid fa-calculator"></i></button>
        <button onclick="switchPage('dua')" id="nav-dua" class="nav-btn text-white/50"><i class="fa-solid fa-hands-praying"></i></button>
    </nav>

    <script>
        // --- TIME FORMATTER (12 HOUR) ---
        function format12h(timeStr) {
            if (!timeStr) return "--:--";
            let [h, m] = timeStr.split(':');
            let period = h >= 12 ? 'PM' : 'AM';
            h = h % 12 || 12;
            return `${h}:${m} ${period}`;
        }

        // --- CORE FUNCTIONS ---
        function switchPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('nav-active'));
            const activeNav = document.getElementById('nav-' + id);
            if(activeNav) activeNav.classList.add('nav-active');
            if(id === 'dua') renderDuas();
            window.scrollTo(0,0);
        }

        async function fetchTimes(city = "Lakshmipur") {
            try {
                const res = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Bangladesh&method=1`);
                const data = await res.json();
                const t = data.data.timings;

                // Update UI with 12h format
                document.getElementById('suhur-time').innerText = format12h(t.Fajr);
                document.getElementById('iftar-time').innerText = format12h(t.Maghrib);
                document.getElementById('hijri-date').innerText = `${data.data.date.hijri.day} ${data.data.date.hijri.month.en} ${data.data.date.hijri.year}`;
                document.getElementById('gregorian-date').innerText = data.data.date.readable;

                document.getElementById('full-schedule').innerHTML = `
                    <div class="flex justify-between"><span>ফজর:</span> <span>${format12h(t.Fajr)}</span></div>
                    <div class="flex justify-between"><span>যোহর:</span> <span>${format12h(t.Dhuhr)}</span></div>
                    <div class="flex justify-between"><span>আসর:</span> <span>${format12h(t.Asr)}</span></div>
                    <div class="flex justify-between"><span>মাগরিব:</span> <span>${format12h(t.Maghrib)}</span></div>
                    <div class="flex justify-between"><span>এশা:</span> <span>${format12h(t.Isha}</span></div>
                    <div class="flex justify-between"><span>সূর্যোদয়:</span> <span>${format12h(t.Sunrise)}</span></div>
                `;

                updateNextPrayer(t);
            } catch (e) { console.error("API Error"); }
        }

        function updateNextPrayer(t) {
            const now = new Date();
            const mins = now.getHours() * 60 + now.getMinutes();
            const schedule = [
                {n:'ফজর', t:t.Fajr}, {n:'যোহর', t:t.Dhuhr}, {n:'আসর', t:t.Asr}, {n:'মাগরিব', t:t.Maghrib}, {n:'এশা', t:t.Isha}
            ];
            let next = schedule[0];
            for(let p of schedule) {
                const [h, m] = p.t.split(':').map(Number);
                if((h*60+m) > mins) { next = p; break; }
            }
            document.getElementById('next-prayer-name').innerText = next.n;
            document.getElementById('next-prayer-time').innerText = format12h(next.t);
        }

        // --- QURAN & AUDIO ENGINE ---
        async function openQuran() {
            switchPage('quran');
            const list = document.getElementById('surah-list');
            list.innerHTML = "<div class='text-center py-10 animate-pulse'>সূরা লোড হচ্ছে...</div>";
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            list.innerHTML = data.data.map(s => `
                <div onclick="loadSurah(${s.number}, '${s.name}')" class="p-4 bg-gray-50 rounded-2xl flex justify-between items-center cursor-pointer active:bg-indigo-50 transition">
                    <div class="flex items-center space-x-4">
                        <span class="bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">${s.number}</span>
                        <div class="font-bold text-indigo-900">${s.englishName}</div>
                    </div>
                    <div class="font-arabic text-xl text-indigo-900">${s.name}</div>
                </div>
            `).join('');
        }

        async function loadSurah(num, name) {
            const detail = document.getElementById('surah-detail');
            detail.classList.remove('hidden');
            document.getElementById('surah-title').innerText = name;
            document.getElementById('ayats').innerHTML = "<p class='text-center py-20'>আয়াত লোড হচ্ছে...</p>";

            // Setup Audio URL
            const audio = document.getElementById('surah-audio');
            const audioUrl = `https://download.quranicaudio.com/quran/mishari_rashid_al_afasy/${String(num).padStart(3, '0')}.mp3`;
            audio.src = audioUrl;
            audio.load(); // Force load
            
            // UI Reset
            document.getElementById('play-btn').innerHTML = '<i class="fa-solid fa-play ml-1"></i>';
            document.getElementById('audio-status').innerText = "Reciter: Mishary Al-Afasy";

            try {
                const [arRes, bnRes] = await Promise.all([
                    fetch(`https://api.alquran.cloud/v1/surah/${num}`),
                    fetch(`https://api.alquran.cloud/v1/surah/${num}/bn.bengali`)
                ]);
                const ar = await arRes.json();
                const bn = await bnRes.json();

                document.getElementById('ayats').innerHTML = ar.data.ayahs.map((a, i) => `
                    <div class="border-b border-gray-100 pb-6">
                        <p class="font-arabic text-3xl leading-relaxed text-indigo-950 mb-4" dir="rtl">${a.text}</p>
                        <p class="text-sm text-gray-500 text-left font-semibold leading-relaxed">${bn.data.ayahs[i].text}</p>
                        <div class="text-left mt-2"><span class="text-[10px] bg-indigo-50 text-indigo-400 px-2 py-1 rounded-full font-bold">${a.numberInSurah}</span></div>
                    </div>
                `).join('');
            } catch(e) { document.getElementById('ayats').innerHTML = "লোড করতে সমস্যা হয়েছে।"; }
        }

        function toggleAudio() {
            const audio = document.getElementById('surah-audio');
            const btn = document.getElementById('play-btn');
            const status = document.getElementById('audio-status');

            if (audio.paused) {
                status.innerText = "প্লে হচ্ছে...";
                audio.play().then(() => {
                    btn.innerHTML = '<i class="fa-solid fa-pause"></i>';
                }).catch(e => {
                    status.innerText = "অডিও লোড হতে পারেনি। আবার চেষ্টা করুন।";
                    console.error(e);
                });
            } else {
                audio.pause();
                btn.innerHTML = '<i class="fa-solid fa-play ml-1"></i>';
                status.innerText = "বন্ধ আছে";
            }
        }

        function closeSurah() {
            document.getElementById('surah-detail').classList.add('hidden');
            const audio = document.getElementById('surah-audio');
            audio.pause();
            audio.src = ""; // Stop buffer
        }

        // --- TASBIH & DUAS ---
        function renderDuas() {
            const list = document.getElementById('dua-list');
            list.innerHTML = duas.map(d => `
                <div class="bg-gray-50 p-5 rounded-3xl border border-gray-100">
                    <p class="text-xs font-black text-indigo-500 mb-2 uppercase">${d.t}</p>
                    <p class="font-arabic text-2xl mb-2" dir="rtl">${d.a}</p>
                    <p class="text-sm text-gray-600 font-bold">${d.b}</p>
                </div>
            `).join('');
        }

        let tc = 0;
        function countT() { tc++; document.getElementById('t-count').innerText = tc; if(navigator.vibrate) navigator.vibrate(50); }
        function resetT() { tc = 0; document.getElementById('t-count').innerText = 0; }

        async function openNames() {
            switchPage('names');
            const res = await fetch('https://api.aladhan.com/v1/asmaAlHusna');
            const data = await res.json();
            document.getElementById('names-grid').innerHTML = data.data.map(n => `
                <div class="bg-white border border-gray-100 p-4 rounded-2xl text-center shadow-sm">
                    <p class="font-arabic text-2xl text-indigo-900">${n.name}</p>
                    <p class="text-xs font-bold text-gray-400 mt-1">${n.transliteration}</p>
                </div>
            `).join('');
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => fetchTimes(null, p.coords.latitude, p.coords.longitude), () => fetchTimes());
            } else { fetchTimes(); }
        }

        window.onload = () => fetchTimes();
    </script>
</body>
  </html>
